{% extends 'blog/base.html' %}
{% load blog_tags %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto; padding: 20px;">

    {% if query %}
    <div
        style="background: #ebf5fb; border-left: 4px solid #3498db; padding: 15px 20px; border-radius: 8px; margin-bottom: 25px;">
        <h3 style="margin: 0; color: #2c3e50; font-size: 1.1rem;">ğŸ” æœç´¢ç»“æœï¼š "{{ query }}"</h3>
        <p style="margin: 5px 0 0; color: #5d6d7e; font-size: 0.9rem;">å…±æ‰¾åˆ° $ {{ posts.count }} $ ç¯‡æ–‡ç«  Â· <a
                href="{% url 'post_list' %}" style="color: #3498db; text-decoration: none;">æ¸…é™¤æœç´¢</a></p>
    </div>
    {% endif %}

    {% if tag %}
    <div
        style="background: #f4f6f7; border-left: 4px solid #95a5a6; padding: 15px 20px; border-radius: 8px; margin-bottom: 25px;">
        <h3 style="margin: 0; color: #2c3e50; font-size: 1.1rem;">ğŸ·ï¸ æ ‡ç­¾ç­›é€‰ï¼š# {{ tag.name }}</h3>
        <p style="margin: 5px 0 0; color: #5d6d7e; font-size: 0.9rem;"><a href="{% url 'post_list' %}"
                style="color: #3498db; text-decoration: none;">æŸ¥çœ‹å…¨éƒ¨æ–‡ç« </a></p>
    </div>
    {% endif %}

    <div class="post-feed">
        {% for post in posts %}
        <article class="post-card"
            style="background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 30px; border: 1px solid #f0f0f0; transition: transform 0.2s ease;">

            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <img src="{% if post.author.profile.avatar %}{{ post.author.profile.avatar.url }}{% else %}/static/images/default.png{% endif %}"
                        style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                    <span style="font-weight: 600; color: #34495e; font-size: 0.95rem;">
                        <a href="{% url 'profile_public' post.author.username %}"
                            style="text-decoration: none; color: inherit;">
                            {{ post.author.profile.nickname|default:post.author.username }}
                        </a>
                    </span>
                </div>
                <time style="color: #95a5a6; font-size: 0.85rem;">ğŸ“… {{ post.published_date|date:"Y-m-d" }}</time>
            </div>

            <h2 style="margin: 0 0 12px 0; font-size: 1.5rem;">
                <a href="{% url 'post_detail' pk=post.pk %}"
                    style="color: #2c3e50; text-decoration: none; transition: color 0.2s;">{{ post.title }}</a>
            </h2>

            <div class="post-content" style="
                    color: #5d6d7e; 
                    line-height: 1.7; 
                    margin-bottom: 20px; 
                    font-size: 1rem;
                    overflow: hidden;
                    display: -webkit-box;
                    -webkit-line-clamp: 5;
                    -webkit-box-orient: vertical;
                ">
                {{ post.text|markdown|truncatewords_html:50 }}
            </div>

            <div
                style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f8f9fa; padding-top: 15px; margin-top: 15px;">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    {% for t in post.tags.all %}
                    <a href="{% url 'post_list_by_tag' tag_name=t.name %}"
                        style="background: #f1f8ff; color: #0366d6; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; text-decoration: none; font-weight: 500;">
                        # {{ t.name }}
                    </a>
                    {% endfor %}
                </div>

                <a href="{% url 'post_detail' pk=post.pk %}" class="read-more-btn"
                    style="color: #3498db; font-size: 0.9rem; font-weight: 600; text-decoration: none; border: 1px solid #3498db; padding: 5px 15px; border-radius: 20px; transition: all 0.3s;">
                    é˜…è¯»å…¨æ–‡ â†’
                </a>
            </div>
        </article>

        {% empty %}
        <div style="text-align: center; padding: 80px 0; background: white; border-radius: 15px;">
            <p style="font-size: 4rem; margin-bottom: 20px;">ğŸ˜…</p>
            <p style="font-size: 1.2rem; color: #bdc3c7;">æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </p>
            <a href="{% url 'post_list' %}" style="color: #3498db; text-decoration: underline;">è¿”å›ä¸»é¡µ</a>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .post-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
    }

    .post-card h2 a:hover {
        color: #3498db !important;
    }

    .read-more-btn:hover {
        background-color: #3498db;
        color: white !important;
    }
</style>
{% endblock %}